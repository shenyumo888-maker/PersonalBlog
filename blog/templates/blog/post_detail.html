<!-- templates/blog/post_detail.html -->
 <!-- template test: 2025-11-04 -->
{% endblock %}
{% extends "base.html" %}
{% block content %}
<article>
  <h1>{{ post.title }}</h1>
  <p><small>作者：{{ post.author }} · {{ post.created_at|date:"Y-m-d H:i" }}</small></p>
  <div>{{ post.content|linebreaks }}</div>
</article>

<!-- 从这里开始是新增的点赞功能 -->
<div style="margin: 15px 0;">  <!-- 增加上下间距，让样式更美观 -->
  {% if user.is_authenticated %}
    <form action="{% url 'comments:toggle_like' slug=post.slug %}" method="post" style="display: inline;">
      {% csrf_token %}
      {% if user in post.likes.all %}
        <button type="submit" style="padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
          取消点赞
        </button>
      {% else %}
        <button type="submit" style="padding: 5px 10px; background: #0d6efd; color: white; border: none; border-radius: 4px; cursor: pointer;">
          点赞
        </button>
      {% endif %}
    </form>
  {% else %}
    <a href="{% url 'accounts:login' %}" style="padding: 5px 10px; background: #0d6efd; color: white; border: none; border-radius: 4px; text-decoration: none;">
      登录后点赞
    </a>
  {% endif %}
  <span style="margin-left: 10px; color: #666;">
    点赞数：{{ post.likes.count }}
  </span>
</div>
<!-- 点赞功能结束 -->


{% if user.is_authenticated %}
  {% if user == post.author or user.is_staff %}
    <p>
      <a href="{% url 'blog:post_edit' slug=post.slug %}">编辑</a> |
      <a href="{% url 'blog:post_delete' slug=post.slug %}">删除</a>
    </p>
  {% endif %}
{% endif %}

<a href="{% url 'blog:post_list' %}">返回列表</a>
{% endblock %}
